 # ti-study

무선어뎁터 구매시 vmware에 칼리 셋팅에 들어가서 usb3.1모드와 input 관련 맨위 박스를 체크
그리리고 터미네이터에서 iwconfig에서 모드 상태가 모니터인지 메니저인지 확인 후 
ifconfig wlan0 down 으로 매니저모드를 꺼주고
airmon-ng check kill 을 커맨드해서 불필요한 기능도 꺼준다.


 
주변 무선네트워크 확인하는 법
airodump-ng mon0
프로그램 종료는 Control+C
ESSIBS는 대상 무선네트워크의 이름
BSSSID는 대상 네트워크의 맥주소
PWR는 네트워크 강도의 세기(숫자가 높을 수록 강도 좋음)
Beans ap(액세스포인트)가 보내는 신호를 나타내며 숨김 등의 상황에서 이용 가능하며 강할수록 패킷수집이 빨리된다.
Date는 데이터 패킷, 데이터 프레임의 수를 뜻함.
/s는 10초간 수집한 데이터 패킷 수를 표시
Ch 네트워크가 작동하는 채널
MB 네트워크가 지원하는 최대 속도
ENC(인크립셥) 해당 네트워크에서 패킷 암호화에 사용된 방식을 표시. 데이터 변환을 위한 것이지 보안 목적은 아님. OPEN은 암호화x 열린네트워크, 주로 wpa2. 암호화 과정
CIPHER(싸이퍼) 인크립션의 네트워크 암호화와 달리 실제 데이터를 암호화하는 방식. CCMP, RC4 등이 있음. 데이터 보호를 위한 것으로 올바른 키가 없으면 복원 불가. 암호화 방법
AUTH 해당 네트워크에서 사용하는 인증.
Wi-FI band(와이파이 대역) 네트워크 사용할 수 있는 주파수를 정의. ex)2.4ghz
일반적으로 airdump-ng에서는 2.4ghz만 가능
5.0ghz는 airodum-ng --band a로, --band ang는 2.4, 5.0. 6.0까지 한번에 찾아준다.

특정 네트워크 패킷 스니핑(모니터링)하는 법
airodump-ng --bssid ~~ --channel ~~ -write ~~~ wlan0
위 커맨드 입력시 해당 bssid와 연결된 클라이언트, 기기를 확인하고 station에는 클라이언트, 사용자 기기의 mac 주소를 알려준다.
bssid가 동일하면 클라이언트, 기기가 달라도 같은 네트워크에 연결 했다는 뜻이다.
rate는 속도, lost는 손실된 데이터양, probe는 기기(클라이언트)가 해당 네트워크를 검색하고 있는지 표시.
control+c 입력 시 airodump-ng가 종료되고 파일들이 생성됨.
생성파일 중엔 주로 .cap를 활용.
.cap에는 스니핑 동안 모든 데이터가 들어감. ex)url, 채팅 메시지, 사용자 이름, 비밀번호 등
.cap에 담긴 데이터 활용은 enc를 wireshark를 이용해서 복호화 해야한다.
wireshark는 .cap 데이터를 통해 출발,목적지 ip주소, 프로토콜, 데이터내용 확인 가능.
ex)wireshark 도구 사용 시 source창에 mac주소와 제조사 등을 볼 수 있다.

사전연결공격
deauthentication attack
인증 해제 시키는 공격. 특정 네트워크와 연결 하기 전에 해당 네트워크에 속한 클라이언트(기기)의 연결을 해제시킴. 
해당 공격이 유용한 이유는 네트워크의 비밀번호를 몰라도 된다.
우선 대상 클라이언트(기기)의 mac주소로 내 모니터링 무선어뎁터에 위장(변경)시킨 뒤 라우터(특정 네트워크)에 연결 해제를 명령함.
aireplay-ng --deauth (숫자) -a (대상 라우터, 엑세스포인트, 네트워크의 맥주소) -c (대상 클라이언트 맥주소, station에 표시됨.) -d(5ghz일 경우에는 입력해줘야 한다.) mon0
ex)(숫자)란에 10,000을 입력 시 10,000개의 패킷을 인증 해제 시킴. 즉 패킷 숫자만큼 특정 네트워크에 인증 해제 요청을 보내는 것으로 패킷 수가 많을 수록 대상 클라이언트의 연결이 해제된다.

사전연결 공격을 하는 이유
인증이 해제 되면 자동으로 연결도 해제되기에 대상 클라이언트는 연결이 되지 않는 상태를 해결하려함.
이 때 해커들이 it전문가 행세를 해서 백도어를 만들거나,
대상 클라이언트가 재접속 시도 시 handshake로 캡처하여 wpa크래킹한다.

wep 해킹

wep는 오래된 인크립션으로 rc4를 싸이퍼로 하는 오래된 방식으로 잘 사용되지 않는다.
wep는 송신 시 각각의 패킷마다 고유한 키스트림(변형키)을 생성한다.
기본 wep키는 고정인데 패킷마다 24bit짜리 랜덤 값을 가진 IV(초기화벡터를)를 이용해서 키스트림을 만든다.
이 키스트림으로 패킷에 암호화하여 암호화한 패킷을 복호화하지 않고 보게 되면 텍스트가 이상한 글자로 변환되어 있음.
송신시 암호화된 패킷과 iv를 같이 보낸다.
수신 받은 라우터(액세스포인트)는 가지고 있던 기본 wep와 수신 받은 iv로 키스트림을 만들어서 암호화된 패킷을 복호화한다.

문제점
aircrack-ng를 이용하면 패킷을 스니핑하고 스니핑한 패킷의 iv들에서 wep키를 추출해냄.
추출이 가능한 이유는 24bit 내의 평문의 iv는 만들어 낼 수 있는 것이 제한적이라 중복이 생기고 통계적 분석공격으로 가능.

방법
airodump-ng --bssid --channel --write -mon0
이후 ls 커맨드로 디렉토리 내 파일들 보기로 .cap가 있는지 확인.
aircrack-ng .cap 커맨드 후 표시창에 key found 뜨면 성공
ASCII가 뜨면 사람이 직접 입력 가능한 wep키이나 
hex키는 11:22:33:44:55같은 형식으로 :부분을 없애고 1122334455로 치면 wep키가 된다.

주의점
네트워크, 서버와 클라이언트 간 주고 받는 데이터가 활발하지 않는 경우에는
ap(액세스포인트)가 새 패킷을 생성하게 강제해야한다.
aireplay-ng fakeauth
 





25. 2. 18.
wpa, wpa2 하에서 해킹
pin번호를 입력하는 wps 방식의 기능을 활성화 해둔 경우.
airodump-ng 말고 wps 기능 활성화 하에서는 다른 방법으로 네트워크를 확인해야 한다.
wash라는 도구를 이용
wash --interface mon0(모니터모드가 활성된 장비)
누르면 네트워크 목록이 나온다.
vendor에는 네트워크의 액세스 포인트의하드웨어 벤더(제조사) 정보가 나온다.
lck는 wps가 잠김 상태인지 아닌지 알려준다.
wps에는 wps의 버전 정보가 나온다.
dBM은 신호강도이다.
wpa나 wpa2 상관 없이 wpa 기능을 이용하면 해킹이 가능하다.
해킹이 실패한다면 pbc(푸시 버튼 인증)을 사용 중이기 때문이다.
우선 bssid에서 맥 주소를 카피해서 가짜 인증 공격으로 대상 네트워크와 결합한다.
aireplay-ng --fakeauth 30(이전에 0은 바로바로 결합이지만 30은 30초마다 결합) -a 00:11:22:33:44:55:66(대상맥주소) -h (무선네트워크 맥주소, ifconfig로 upsepc의 첫12자리, -를 :로 변경) mon0(무선어뎁터명 명시)
ex)aireplay-ng --fakeauth 30 -a 11:22:33:44:55 -h 48:52:32:11:22:33 -mon0
reaver는 pin을 이용한 무차별 대입공격, 맞는 비밀번호가 나올 때까지 계속 시도해서 성공하면 wpa키 값을 연산한다.
커맨드는
reaver --bssid 11:22:33:44:55:66:(대상네트워크 mac주소) --channel 1(대상 네트워크 채널 값) --interface mon0(모니터모드에 있는 무선어뎁터를 명시) -vvv(실패경우 등에 많은 정보를 알려줌.) --no-associate(reaver에게 결합은 하지말라는 것. reaver 자체 결합기능이 있으나 실패경우가 많다.)
ex)reaver --bsssid 11:22:33:44:55:66: --channel 1 --interface mon0 --vvv --no-associate
reaver 커맨드 입력 후 네트워크 결합 커맨드인 aireplay-ng 커맨드를 입력, 별도 결합을 시켜줘야한다.
wps pin에 나오는 값이 pin 값이다.
wpa psk에 나오는 값이 wpa의 키 값이다.
ap ssid에 나오는 것이 라우터 이름이다.

zenmap으로 서버 대상 해킹이 가능하다.
metasploitable에서 ping을 보내 응답을 받아낸 것처럼 웹사이트의 ip 또한 같은 방식으로 얻을 수 있다.
metasploitable에서 특정 웹사이트 대상으로 ping facebookc.om 이런 식으로 커맨드 입력
그러면 해당 ip를 응답해주고 응답 받은 ip로 zenmap을 실행하면 facebook에서 실행 중인 모든 서비스 목록을 얻을 수 있음.

